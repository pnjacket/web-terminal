<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Terminal</title>
  <link rel="stylesheet" href="/vendor/xterm.css">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="session-body">
  <div class="session-layout">
    <div id="terminal-container" class="terminal-container"></div>
    <div id="resizer" class="resizer"></div>
    <div id="editor-panel" class="editor-panel">
      <div id="editor-tabs" class="editor-tabs"></div>
      <div class="editor-toolbar">
        <button class="editor-btn" id="etn-send">Send</button>
        <button class="editor-btn" id="etn-copy">Copy</button>
        <button class="editor-btn" id="etn-export">Export</button>
        <button class="editor-btn" id="etn-delete">Delete</button>
        <button class="editor-btn" id="etn-delete-all">Delete All</button>
        <button class="editor-btn" id="etn-preset">Preset…</button>
      </div>
      <div id="preset-popup" class="preset-popup" style="display:none">
        <div id="preset-popup-items"></div>
        <div class="preset-popup-sep"></div>
        <div class="preset-popup-item" id="preset-popup-open">Open Editor…</div>
      </div>
      <div id="editor-area" class="editor-area"></div>
    </div>
  </div>

  <div id="status-bar" class="status-bar"></div>

  <!-- Session ended overlay -->
  <div id="session-ended" class="session-ended-overlay" style="display:none;">
    <div class="session-ended-box">
      <p>Session ended</p>
      <a href="/" class="btn btn-primary">Back to sessions</a>
    </div>
  </div>

  <!-- Delete confirmation modal -->
  <div id="editor-confirm" class="modal-overlay" style="display:none">
    <div class="modal-box">
      <p class="modal-title" id="editor-confirm-title">Delete read-only tabs?</p>
      <p id="editor-confirm-msg" style="color:#aaa;font-size:13px;margin-bottom:16px"></p>
      <div class="modal-actions">
        <button class="btn" id="editor-confirm-cancel">Cancel</button>
        <button class="btn btn-danger" id="editor-confirm-ok">Delete</button>
      </div>
    </div>
  </div>

  <script src="/vendor/xterm.js"></script>
  <script src="/vendor/xterm-addon-fit.js"></script>
  <script src="/vendor/xterm-addon-web-links.js"></script>
  <script src="/vendor/codemirror.bundle.js"></script>
  <script type="module" src="/js/terminal.js"></script>
  <script type="module" src="/js/session.js"></script>
  <script type="module" src="/js/notes.js"></script>
  <script type="module">
    import { NoteEditor } from '/js/notes.js';
    import { PresetPopup, PresetEditor } from '/js/presets.js';
    window.addEventListener('DOMContentLoaded', () => {
      const sid = window.location.pathname.split('/').pop();
      const ed = new NoteEditor(sid, () => window.getSessionName?.() ?? sid);
      ed.init();

      const presetBtn = document.getElementById('etn-preset');
      new PresetPopup(presetBtn, {
        onInsert: (content) => ed.prependContent(content),
        onOpenEditor: () => new PresetEditor({
          showInsert: true,
          onInsert: (content) => ed.prependContent(content),
        }).open(),
      });
    });
  </script>
</body>
</html>
